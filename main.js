import {
  getThumbnailKey,
  getThumbnailKeyShorts,
} from "./util_functions/util.js";

//---------------------------------Ignore Code between These Lines------------------------------------
// This code is used for setting up the icons of play, back,forward etc.

const restart = document.getElementById("restart");
const back = document.getElementById("back");
const play = document.getElementById("play");
const forward = document.getElementById("forward");
const mute = document.getElementById("mute");

restart.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 22.9167C18.2531 22.9167 22.9167 18.2531 22.9167 12.5C22.9167 6.74689 18.2531 2.08334 12.5 2.08334C6.74689 2.08334 2.08334 6.74689 2.08334 12.5C2.08334 18.2531 6.74689 22.9167 12.5 22.9167ZM16.599 5.82501C16.7427 5.88357 16.8657 5.9836 16.9523 6.11235C17.039 6.2411 17.0853 6.39274 17.0854 6.54793V9.37605C17.0854 9.58325 17.0031 9.78197 16.8566 9.92848C16.7101 10.075 16.5114 10.1573 16.3042 10.1573H13.5417C13.3879 10.1574 13.2375 10.1121 13.1094 10.0271C12.9813 9.94211 12.8811 9.82119 12.8213 9.6795C12.7616 9.53781 12.745 9.38164 12.7737 9.23057C12.8023 9.07949 12.8749 8.94023 12.9823 8.83022L13.7761 8.01772C13.0094 7.78217 12.1925 7.76347 11.4159 7.96369C10.6393 8.16392 9.93325 8.57524 9.37605 9.15209C7.63855 10.9302 7.63855 13.8219 9.37605 15.6C9.78108 16.0194 10.2664 16.353 10.8031 16.5809C11.3398 16.8087 11.9169 16.9261 12.5 16.9261C13.0831 16.9261 13.6602 16.8087 14.1969 16.5809C14.7336 16.353 15.2189 16.0194 15.624 15.6C16.3083 14.8985 16.7493 13.9959 16.8823 13.025C16.9427 12.5896 17.2886 12.2229 17.7281 12.2229C18.1511 12.2229 18.5011 12.5615 18.4604 12.9823C18.3281 14.3791 17.7215 15.6885 16.7417 16.6927C16.1911 17.2611 15.5319 17.7131 14.8033 18.0217C14.0746 18.3304 13.2913 18.4894 12.5 18.4894C11.7087 18.4894 10.9254 18.3304 10.1968 18.0217C9.4681 17.7131 8.80891 17.2611 8.25834 16.6927C5.92814 14.3073 5.92814 10.4458 8.25834 8.06043C9.10821 7.18234 10.2097 6.58971 11.4107 6.36431C12.6118 6.13892 13.8532 6.29188 14.9636 6.80209L15.7448 6.00209C15.8534 5.89098 15.9927 5.81478 16.1449 5.78323C16.297 5.75169 16.4551 5.76623 16.599 5.82501Z" fill="#F5F5F5"/>
</svg>
`;

back.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.49951 11.2046L10.7217 5.68701C10.9498 5.5482 11.2111 5.47319 11.4781 5.46984C11.7451 5.46649 12.0082 5.53492 12.2397 5.66797C12.491 5.81428 12.699 6.02447 12.8428 6.2772C12.9865 6.52994 13.0608 6.8162 13.0581 7.10694V10.9668L21.8823 5.68555C22.1105 5.54673 22.3717 5.47173 22.6387 5.46838C22.9058 5.46503 23.1688 5.53345 23.4004 5.66651C23.6516 5.81281 23.8597 6.02301 24.0034 6.27574C24.1472 6.52847 24.2214 6.81474 24.2187 7.10547V17.8965C24.2216 18.1873 24.1474 18.4737 24.0036 18.7265C23.8599 18.9794 23.6517 19.1896 23.4004 19.3359C23.1688 19.469 22.9058 19.5374 22.6387 19.5341C22.3717 19.5307 22.1105 19.4557 21.8823 19.3169L13.0581 14.0332V17.8945C13.0613 18.1857 12.9872 18.4725 12.8435 18.7257C12.6997 18.9789 12.4914 19.1895 12.2397 19.3359C12.0082 19.469 11.7451 19.5374 11.4781 19.5341C11.2111 19.5307 10.9498 19.4557 10.7217 19.3169L1.49951 13.7993C1.28027 13.662 1.09952 13.4712 0.974229 13.2449C0.848935 13.0185 0.783203 12.7641 0.783203 12.5054C0.783203 12.2467 0.848935 11.9922 0.974229 11.7659C1.09952 11.5395 1.28027 11.3488 1.49951 11.2114V11.2046Z" fill="#F5F5F5"/>
</svg>
`;

play.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.5 22.9167C11.059 22.9167 9.70487 22.6431 8.43751 22.0958C7.17015 21.5486 6.06772 20.8066 5.13022 19.8698C4.19272 18.9323 3.4507 17.8299 2.90418 16.5625C2.35765 15.2951 2.08404 13.941 2.08334 12.5C2.08334 11.059 2.35695 9.70487 2.90418 8.43751C3.4514 7.17015 4.19341 6.06772 5.13022 5.13022C6.06772 4.19272 7.17015 3.4507 8.43751 2.90418C9.70487 2.35765 11.059 2.08404 12.5 2.08334C13.941 2.08334 15.2951 2.35695 16.5625 2.90418C17.8299 3.4514 18.9323 4.19341 19.8698 5.13022C20.8073 6.06772 21.5497 7.17015 22.0969 8.43751C22.6441 9.70487 22.9174 11.059 22.9167 12.5C22.9167 13.941 22.6431 15.2951 22.0958 16.5625C21.5486 17.8299 20.8066 18.9323 19.8698 19.8698C18.9323 20.8073 17.8299 21.5497 16.5625 22.0969C15.2951 22.6441 13.941 22.9174 12.5 22.9167Z" fill="#F5F5F5"/>
</svg>
`;

forward.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.5005 11.2046L14.2783 5.68701C14.0502 5.5482 13.7889 5.47319 13.5219 5.46984C13.2549 5.46649 12.9918 5.53492 12.7603 5.66797C12.509 5.81428 12.301 6.02447 12.1572 6.2772C12.0135 6.52994 11.9392 6.8162 11.9419 7.10694V10.9668L3.11769 5.68555C2.88954 5.54673 2.6283 5.47173 2.36126 5.46838C2.09422 5.46503 1.83118 5.53345 1.59962 5.66651C1.34837 5.81281 1.14032 6.02301 0.996586 6.27574C0.852854 6.52847 0.778565 6.81474 0.781265 7.10547V17.8965C0.778479 18.1873 0.852726 18.4737 0.996463 18.7265C1.1402 18.9793 1.3483 19.1896 1.59962 19.3359C1.83118 19.469 2.09422 19.5374 2.36126 19.5341C2.6283 19.5307 2.88954 19.4557 3.11769 19.3169L11.9419 14.0332V17.8945C11.9388 18.1857 12.0129 18.4725 12.1566 18.7257C12.3004 18.9788 12.5087 19.1894 12.7603 19.3359C12.9918 19.469 13.2549 19.5374 13.5219 19.5341C13.7889 19.5307 14.0502 19.4557 14.2783 19.3169L23.5005 13.7993C23.7197 13.662 23.9005 13.4712 24.0258 13.2449C24.1511 13.0185 24.2168 12.7641 24.2168 12.5054C24.2168 12.2467 24.1511 11.9922 24.0258 11.7659C23.9005 11.5395 23.7197 11.3488 23.5005 11.2114V11.2046Z" fill="#F5F5F5"/>
</svg>
`;

getMuteIcon();

function getMuteIcon() {
  chrome.tabs.query({}, function (tabs) {
    youtubeObject = tabs.find((tabObject) =>
      tabObject.url.includes("www.youtube.com")
    );

    if (!youtubeObject.mutedInfo.muted) {
      mute.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M15 3.75749C15 2.66624 13.7 2.09874 12.9 2.84124L8.06 7.33249C7.94454 7.43995 7.79273 7.49979 7.635 7.49999H4.375C3.87772 7.49999 3.40081 7.69754 3.04917 8.04917C2.69754 8.4008 2.5 8.87771 2.5 9.37499V15.625C2.5 16.1223 2.69754 16.5992 3.04917 16.9508C3.40081 17.3024 3.87772 17.5 4.375 17.5H7.63375C7.79131 17.4999 7.9431 17.5592 8.05875 17.6662L12.9 22.1587C13.7 22.9 15 22.3337 15 21.2425V3.75749ZM19.0675 5.78374C19.1287 5.72908 19.2001 5.68701 19.2776 5.65994C19.3551 5.63286 19.4372 5.62132 19.5191 5.62596C19.6011 5.63061 19.6813 5.65134 19.7552 5.687C19.8292 5.72265 19.8953 5.77251 19.95 5.83374C21.5896 7.6671 22.4961 10.0404 22.4961 12.5C22.4961 14.9596 21.5896 17.3329 19.95 19.1662C19.8955 19.2283 19.8293 19.2789 19.7551 19.3151C19.6809 19.3514 19.6003 19.3726 19.5179 19.3776C19.4355 19.3825 19.3529 19.3711 19.2749 19.3439C19.1969 19.3167 19.1251 19.2744 19.0636 19.2193C19.0021 19.1643 18.9521 19.0975 18.9165 19.023C18.8809 18.9485 18.8605 18.8677 18.8563 18.7853C18.8521 18.7028 18.8643 18.6203 18.8922 18.5426C18.9201 18.4649 18.9631 18.3935 19.0188 18.3325C20.4535 16.7283 21.2467 14.6516 21.2467 12.4994C21.2467 10.3472 20.4535 8.27045 19.0188 6.66624C18.9082 6.54275 18.8512 6.3804 18.8604 6.2149C18.8695 6.0494 18.944 5.89431 19.0675 5.78374ZM17.5988 16.1662C17.5276 16.1253 17.4652 16.0707 17.4151 16.0057C17.365 15.9406 17.3282 15.8663 17.3068 15.787C17.2855 15.7077 17.28 15.625 17.2906 15.5436C17.3012 15.4622 17.3278 15.3836 17.3688 15.3125C17.8627 14.4575 18.1227 13.4874 18.1227 12.5C18.1227 11.5125 17.8627 10.5425 17.3688 9.68749C17.3235 9.61636 17.2932 9.53681 17.2795 9.45363C17.2658 9.37046 17.2691 9.28537 17.2891 9.2035C17.3092 9.12163 17.3456 9.04466 17.3962 8.97722C17.4468 8.90978 17.5104 8.85327 17.5834 8.81109C17.6564 8.76891 17.7372 8.74192 17.8208 8.73176C17.9045 8.72159 17.9894 8.72846 18.0703 8.75195C18.1513 8.77543 18.2267 8.81505 18.2919 8.86842C18.3572 8.92179 18.4109 8.9878 18.45 9.06249C19.0538 10.1074 19.3719 11.293 19.3721 12.4998C19.3723 13.7067 19.0547 14.8923 18.4512 15.9375C18.3684 16.0807 18.2321 16.1852 18.0723 16.2281C17.9125 16.271 17.7422 16.2487 17.5988 16.1662Z" fill="#F5F5F5"/>
      </svg>
      `;
    } else {
      mute.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14.0625 4.22915C14.0625 2.83749 12.3792 2.14061 11.3958 3.12499L6.70834 7.81249H4.69584C3.5073 7.81249 2.28126 8.50415 1.92501 9.79686C1.68332 10.6775 1.56139 11.5868 1.56251 12.5C1.56251 13.4354 1.68855 14.3417 1.92709 15.2031C2.2823 16.4948 3.50834 17.1875 4.69688 17.1875H6.7073L11.3948 21.875C12.3792 22.8594 14.0625 22.1625 14.0625 20.7708V4.22915ZM18.5208 9.60415C18.4493 9.5274 18.3631 9.46583 18.2672 9.42313C18.1714 9.38043 18.0679 9.35747 17.9631 9.35562C17.8582 9.35377 17.754 9.37307 17.6567 9.41236C17.5594 9.45165 17.471 9.51014 17.3968 9.58432C17.3227 9.65851 17.2642 9.74688 17.2249 9.84416C17.1856 9.94143 17.1663 10.0456 17.1681 10.1505C17.17 10.2554 17.193 10.3589 17.2357 10.4547C17.2784 10.5505 17.3399 10.6368 17.4167 10.7083L19.2083 12.5L17.4167 14.2917C17.2787 14.4398 17.2035 14.6356 17.2071 14.838C17.2107 15.0404 17.2927 15.2335 17.4358 15.3767C17.579 15.5198 17.7721 15.6018 17.9745 15.6054C18.1769 15.6089 18.3727 15.5338 18.5208 15.3958L20.3125 13.6042L22.1042 15.3958C22.1757 15.4726 22.2619 15.5341 22.3578 15.5768C22.4536 15.6195 22.5571 15.6425 22.662 15.6444C22.7669 15.6462 22.8711 15.6269 22.9683 15.5876C23.0656 15.5483 23.154 15.4898 23.2282 15.4157C23.3024 15.3415 23.3608 15.2531 23.4001 15.1558C23.4394 15.0585 23.4587 14.9543 23.4569 14.8494C23.455 14.7445 23.4321 14.6411 23.3894 14.5453C23.3467 14.4494 23.2851 14.3632 23.2083 14.2917L21.4167 12.5L23.2083 10.7083C23.3463 10.5602 23.4215 10.3643 23.4179 10.1619C23.4143 9.95955 23.3323 9.76644 23.1892 9.6233C23.0461 9.48016 22.8529 9.39817 22.6506 9.3946C22.4482 9.39102 22.2523 9.46615 22.1042 9.60415L20.3125 11.3958L18.5208 9.60415Z" fill="#F5F5F5"/>
      </svg>
      `;
    }
  });
}

//---------------------------------Ignore Code between These Lines------------------------------------

let youtubeObject = null;
const title = document.getElementById("title");
const thumbnail = document.getElementById("thumbnail");

chrome.tabs.query({}, function (tabs) {
  youtubeObject = tabs.find((tabObject) =>
    tabObject.url.includes("www.youtube.com")
  );

  if (!youtubeObject || youtubeObject.url === `https:www.youtube.com`) {
    youtubeObject = { title: "No Video is currently playing" };
    document.getElementById("wrapper").style.display = "none";
  }

  title.innerHTML = `${youtubeObject.title}`;

  if (youtubeObject.url.includes("shorts")) {
    document.getElementById(
      "app"
    ).style.background = `url(https://i.ytimg.com/vi/${getThumbnailKeyShorts(
      youtubeObject
    )}/hq720.jpg) no-repeat center center fixed`;
    document.getElementById("app").style.backgroundSize = "400px 200px";
  } else {
    document.getElementById(
      "app"
    ).style.background = `url(https://i.ytimg.com/vi/${getThumbnailKey(
      youtubeObject
    )}/hq720.jpg) no-repeat center center fixed`;
    document.getElementById("app").style.backgroundSize = "400px 200px";
  }

  addEventListeners();

  function addEventListeners() {
    document.getElementById("restart").addEventListener("click", function () {
      chrome.scripting
        .executeScript({
          target: { tabId: youtubeObject.id },
          files: ["./basic_functions/restart.js"],
        })
        .then(() => console.log("script injected"));
    });

    document.getElementById("forward").addEventListener("click", function () {
      chrome.scripting
        .executeScript({
          target: { tabId: youtubeObject.id },
          files: ["./basic_functions/forward.js"],
        })
        .then(() => console.log("script injected"));
    });

    document.getElementById("back").addEventListener("click", function () {
      chrome.scripting
        .executeScript({
          target: { tabId: youtubeObject.id },
          files: ["./basic_functions/back.js"],
        })
        .then(() => console.log("script injected"));
    });

    document.getElementById("play").addEventListener("click", function () {
      chrome.scripting
        .executeScript({
          target: { tabId: youtubeObject.id },
          files: ["./basic_functions/play.js"],
        })
        .then(() => console.log("script injected"));
    });

    document.getElementById("mute").addEventListener("click", function () {
      if (!youtubeObject.mutedInfo.muted) {
        chrome.tabs.update(youtubeObject.id, { muted: true });
        youtubeObject.mutedInfo.muted = true;
        // the tabs object (which contains all the tabs and there info),
        // is not getting updated with the new data, i would need to
        // refetch that. In the Mean time this is a temporary fix
        mute.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14.0625 4.22915C14.0625 2.83749 12.3792 2.14061 11.3958 3.12499L6.70834 7.81249H4.69584C3.5073 7.81249 2.28126 8.50415 1.92501 9.79686C1.68332 10.6775 1.56139 11.5868 1.56251 12.5C1.56251 13.4354 1.68855 14.3417 1.92709 15.2031C2.2823 16.4948 3.50834 17.1875 4.69688 17.1875H6.7073L11.3948 21.875C12.3792 22.8594 14.0625 22.1625 14.0625 20.7708V4.22915ZM18.5208 9.60415C18.4493 9.5274 18.3631 9.46583 18.2672 9.42313C18.1714 9.38043 18.0679 9.35747 17.9631 9.35562C17.8582 9.35377 17.754 9.37307 17.6567 9.41236C17.5594 9.45165 17.471 9.51014 17.3968 9.58432C17.3227 9.65851 17.2642 9.74688 17.2249 9.84416C17.1856 9.94143 17.1663 10.0456 17.1681 10.1505C17.17 10.2554 17.193 10.3589 17.2357 10.4547C17.2784 10.5505 17.3399 10.6368 17.4167 10.7083L19.2083 12.5L17.4167 14.2917C17.2787 14.4398 17.2035 14.6356 17.2071 14.838C17.2107 15.0404 17.2927 15.2335 17.4358 15.3767C17.579 15.5198 17.7721 15.6018 17.9745 15.6054C18.1769 15.6089 18.3727 15.5338 18.5208 15.3958L20.3125 13.6042L22.1042 15.3958C22.1757 15.4726 22.2619 15.5341 22.3578 15.5768C22.4536 15.6195 22.5571 15.6425 22.662 15.6444C22.7669 15.6462 22.8711 15.6269 22.9683 15.5876C23.0656 15.5483 23.154 15.4898 23.2282 15.4157C23.3024 15.3415 23.3608 15.2531 23.4001 15.1558C23.4394 15.0585 23.4587 14.9543 23.4569 14.8494C23.455 14.7445 23.4321 14.6411 23.3894 14.5453C23.3467 14.4494 23.2851 14.3632 23.2083 14.2917L21.4167 12.5L23.2083 10.7083C23.3463 10.5602 23.4215 10.3643 23.4179 10.1619C23.4143 9.95955 23.3323 9.76644 23.1892 9.6233C23.0461 9.48016 22.8529 9.39817 22.6506 9.3946C22.4482 9.39102 22.2523 9.46615 22.1042 9.60415L20.3125 11.3958L18.5208 9.60415Z" fill="#F5F5F5"/>
        </svg>
        `;
      } else {
        chrome.tabs.update(youtubeObject.id, { muted: false });
        youtubeObject.mutedInfo.muted = false;
        mute.innerHTML = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15 3.75749C15 2.66624 13.7 2.09874 12.9 2.84124L8.06 7.33249C7.94454 7.43995 7.79273 7.49979 7.635 7.49999H4.375C3.87772 7.49999 3.40081 7.69754 3.04917 8.04917C2.69754 8.4008 2.5 8.87771 2.5 9.37499V15.625C2.5 16.1223 2.69754 16.5992 3.04917 16.9508C3.40081 17.3024 3.87772 17.5 4.375 17.5H7.63375C7.79131 17.4999 7.9431 17.5592 8.05875 17.6662L12.9 22.1587C13.7 22.9 15 22.3337 15 21.2425V3.75749ZM19.0675 5.78374C19.1287 5.72908 19.2001 5.68701 19.2776 5.65994C19.3551 5.63286 19.4372 5.62132 19.5191 5.62596C19.6011 5.63061 19.6813 5.65134 19.7552 5.687C19.8292 5.72265 19.8953 5.77251 19.95 5.83374C21.5896 7.6671 22.4961 10.0404 22.4961 12.5C22.4961 14.9596 21.5896 17.3329 19.95 19.1662C19.8955 19.2283 19.8293 19.2789 19.7551 19.3151C19.6809 19.3514 19.6003 19.3726 19.5179 19.3776C19.4355 19.3825 19.3529 19.3711 19.2749 19.3439C19.1969 19.3167 19.1251 19.2744 19.0636 19.2193C19.0021 19.1643 18.9521 19.0975 18.9165 19.023C18.8809 18.9485 18.8605 18.8677 18.8563 18.7853C18.8521 18.7028 18.8643 18.6203 18.8922 18.5426C18.9201 18.4649 18.9631 18.3935 19.0188 18.3325C20.4535 16.7283 21.2467 14.6516 21.2467 12.4994C21.2467 10.3472 20.4535 8.27045 19.0188 6.66624C18.9082 6.54275 18.8512 6.3804 18.8604 6.2149C18.8695 6.0494 18.944 5.89431 19.0675 5.78374ZM17.5988 16.1662C17.5276 16.1253 17.4652 16.0707 17.4151 16.0057C17.365 15.9406 17.3282 15.8663 17.3068 15.787C17.2855 15.7077 17.28 15.625 17.2906 15.5436C17.3012 15.4622 17.3278 15.3836 17.3688 15.3125C17.8627 14.4575 18.1227 13.4874 18.1227 12.5C18.1227 11.5125 17.8627 10.5425 17.3688 9.68749C17.3235 9.61636 17.2932 9.53681 17.2795 9.45363C17.2658 9.37046 17.2691 9.28537 17.2891 9.2035C17.3092 9.12163 17.3456 9.04466 17.3962 8.97722C17.4468 8.90978 17.5104 8.85327 17.5834 8.81109C17.6564 8.76891 17.7372 8.74192 17.8208 8.73176C17.9045 8.72159 17.9894 8.72846 18.0703 8.75195C18.1513 8.77543 18.2267 8.81505 18.2919 8.86842C18.3572 8.92179 18.4109 8.9878 18.45 9.06249C19.0538 10.1074 19.3719 11.293 19.3721 12.4998C19.3723 13.7067 19.0547 14.8923 18.4512 15.9375C18.3684 16.0807 18.2321 16.1852 18.0723 16.2281C17.9125 16.271 17.7422 16.2487 17.5988 16.1662Z" fill="#F5F5F5"/>
        </svg>
        `;
      }
    });
  }
});
